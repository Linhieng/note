# ts 声明文件(.d.ts) 的相关知识点

写在前言: 声明文件, 解决的是 ts 的声明报错,
因为有一些变量或模块, 我们知道实际运行的时候是可以找到的,
但是在 ts 文件中使用时, ts 会应为找不到该变量或模块的类型声明,
而提示我们不存在该变量或模块.
这个时候我们就需要使用声明文件, 来告知 ts 问变量或模块是实际存在的,
并且由告知 ts 该变量或模块的类型.

## 🍕 问题 / 杂乱

如果遇到: 在声明文件中使用 import 其他模块的类型, 然后使用的时候会报错,
可以参考一下下面这个(来自 element-plus):

```ts
// generated by unplugin-vue-components
// We suggest you to commit this file into source control
// Read more: https://github.com/vuejs/core/pull/3399
import '@vue/runtime-core'

declare module '@vue/runtime-core' {
  export interface GlobalComponents {
    BaseHeader: typeof import('./components/layouts/BaseHeader.vue')['default']
    BaseSide: typeof import('./components/layouts/BaseSide.vue')['default']
    ElButton: typeof import('element-plus/es')['ElButton']
    ElConfigProvider: typeof import('element-plus/es')['ElConfigProvider']
    ElDatePicker: typeof import('element-plus/es')['ElDatePicker']
    ElIcon: typeof import('element-plus/es')['ElIcon']
    ElInput: typeof import('element-plus/es')['ElInput']
    ElMenu: typeof import('element-plus/es')['ElMenu']
    ElMenuItem: typeof import('element-plus/es')['ElMenuItem']
    ElMenuItemGroup: typeof import('element-plus/es')['ElMenuItemGroup']
    ElSubMenu: typeof import('element-plus/es')['ElSubMenu']
    ElTag: typeof import('element-plus/es')['ElTag']
    HelloWorld: typeof import('./components/HelloWorld.vue')['default']
  }
}

export {}
```

## 🍕 注意事项

声明文件允许全局声明, 但这只是在检查的过程中有效,
在实际运行过程中(js), 应该确保全局变量 "确实" 是 "全局"!

## 🍕 全局声明

### 准备工作:

- 创建 `global.d.ts` 声明文件
- 创建 `index.ts` 文件, 用于测试
- 确保 `tsconfig.json` 中的 `include` 属性包含 `global.d.ts` 和 `index.ts` 文件路径.
- (可选) 如果使用了 eslint, 还需要在 `.eslintrc` 中将全局变量添加到 `globals` 属性中

### 全局变量

```ts
// index.ts
console.log(foo)
```

```ts
// global.d.ts
declare let foo: number
```

### 全局函数

```ts
// index.ts
greet('hello, world')
```

```ts
// global.d.ts
declare function greet(greeting: string): void
```

### 全局对象 / 声明 namespace (理解可能有偏差)

```ts
// index.ts
myLib.makeGreeting('hello, world')
myLib.numberOfGreetings
```

```ts
// global.d.ts
declare namespace myLib {
  function makeGreeting(s: string): string;
  let numberOfGreetings: number
}
```

### 函数重载

```ts
// index.ts
setWidget(70)
setWidget('70kg')
```

```ts
// global.d.ts
declare function setWidget(n: number): void
declare function setWidget(s: string): void
```

### 全局类

```ts
// index.ts
const myGreet = new Greeter('hello')
console.log(myGreet.greeting)
myGreet.showGreeting()
```

```ts
// global.d.ts
declare class Greeter {
  constructor(greeting: string)
  greeting: string
  showGreeting(): void
}
```